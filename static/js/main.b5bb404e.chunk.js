(this["webpackJsonpfinbox-mini-app"]=this["webpackJsonpfinbox-mini-app"]||[]).push([[0],{297:function(e,t,n){},298:function(e,t,n){},299:function(e,t,n){},300:function(e,t,n){},301:function(e,t,n){},302:function(e,t,n){},303:function(e,t,n){},304:function(e,t,n){"use strict";n.r(t);var c=n(4),r=n(1),a=n.n(r),s=n(48),i=n.n(s),o=n(30),u=n(116),j={apiKey:"AIzaSyCumX0HBTrTWuiyCOkwfSmI_ro5pGEGCzM",authDomain:"finbox-mini-app.firebaseapp.com",databaseURL:"https://finbox-mini-app-default-rtdb.firebaseio.com",projectId:"finbox-mini-app",storageBucket:"finbox-mini-app.appspot.com",messagingSenderId:"261332152446",appId:"1:261332152446:web:1b0638cbb10e860a86a82f"},l=n(42),d=n(36),b=n(32),h=n(117),O=n(108),m=n.n(O),f=n(109),x="SET_USER",p="FETCH_ACCESS_TOKEN",v={access_token:""};var y="SET_FRIENDS",w=[];var g=function(e){return e.friends},k=Object(b.combineReducers)({user:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:v,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case x:return t.payload.user;default:return e}},friends:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:w,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case y:return t.payload.friends;default:return e}}}),_=n(28),N=n.n(_),S=n(37),C=n(49),A=n.n(C),D=N.a.mark(z);function z(){var e,t,n,c;return N.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return e=window.location.search,t=new URLSearchParams(e),n=t.get("vk_app_id"),r.next=5,A.a.send("VKWebAppGetAuthToken",{app_id:Number(n),scope:"friends"}).catch((function(){alert("\u041f\u0440\u0440\u043e\u0438\u0437\u043e\u0448\u043b\u043e \u043a\u0440\u0438\u0442\u0438\u0447\u0435\u0441\u043a\u0430\u044f \u043e\u0448\u0438\u0431\u043a\u0430. \u041f\u043e\u0436\u0430\u043b\u0443\u0439\u0441\u0442\u0430, \u043f\u0435\u0440\u0435\u0437\u0430\u0433\u0440\u0443\u0437\u0438\u0442\u0435 \u043f\u0440\u0438\u043b\u043e\u0436\u0435\u043d\u0438\u0435.")}));case 5:return c=r.sent,r.next=8,Object(S.b)({type:x,payload:{user:{access_token:c.access_token}}});case 8:case"end":return r.stop()}}),D)}var I=N.a.mark(P);function P(){return N.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(S.c)(p,z);case 2:case"end":return e.stop()}}),I)}var E=N.a.mark(M);function M(){var e;return N.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,A.a.send("VKWebAppCallAPIMethod",{method:"friends.get",params:{order:"hints",fields:"nickname,photo_100",v:"5.21",access_token:H.getState().user.access_token}}).catch((function(){alert("\u041f\u0440\u0440\u043e\u0438\u0437\u043e\u0448\u043b\u043e \u043a\u0440\u0438\u0442\u0438\u0447\u0435\u0441\u043a\u0430\u044f \u043e\u0448\u0438\u0431\u043a\u0430. \u041f\u043e\u0436\u0430\u043b\u0443\u0439\u0441\u0442\u0430, \u043f\u0435\u0440\u0435\u0437\u0430\u0433\u0440\u0443\u0437\u0438\u0442\u0435 \u043f\u0440\u0438\u043b\u043e\u0436\u0435\u043d\u0438\u0435.")}));case 2:return e=t.sent,t.next=5,Object(S.b)({type:y,payload:{friends:e.response.items}});case 5:case"end":return t.stop()}}),E)}var T=N.a.mark(F);function F(){return N.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(S.c)(x,M);case 2:case"end":return e.stop()}}),T)}var L=N.a.mark(R);function R(){return N.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(S.a)([P(),F()]);case 2:case"end":return e.stop()}}),L)}var U=n(110),B=Object(h.a)(),H=Object(b.createStore)(k,Object(f.composeWithDevTools)(Object(b.applyMiddleware)(m.a,B)));Object(U.a)();B.run(R);var K=n(50),V=n(10),W=n(307),Y=n(308);function G(){return{type:p}}var J=n(118),q=n(113),X=n(46),Q=n(33),Z=(n(297),Object(Q.block)("dashboard-card"));function $(e){return Object(c.jsx)(V.d,{children:Object(c.jsxs)("div",{className:Z(),children:[e.title&&Object(c.jsx)("span",{className:Z("subtitle"),children:e.title}),e.subtitle&&Object(c.jsx)("strong",{className:Z("title"),children:e.subtitle}),e.children&&Object(c.jsx)("div",{className:Z("children"),children:e.children})]})})}function ee(){var e=window.location.search,t=new URLSearchParams(e).get("vk_user_id");function n(e,t){var n=0;return Object.values(t).forEach((function(t){t.type===e&&(n=Number(t.summary)+n)})),n}return Object(c.jsx)(V.l,{mode:"plain",children:Object(c.jsx)(V.e,{size:"m",children:Object(c.jsx)(l.b,{path:"".concat(t),children:function(e){return e.isLoading?Object(c.jsxs)(c.Fragment,{children:[Object(c.jsx)($,{title:"\u041f\u043e\u043b\u0443\u0447\u0435\u043d\u043d\u044b\u0435 \u0437\u0430\u0439\u043c\u044b",subtitle:Object(c.jsx)(V.x,{size:"small"})}),Object(c.jsx)($,{title:"\u0412\u044b\u0434\u0430\u043d\u043d\u044b\u0435 \u0437\u0430\u0439\u043c\u044b",subtitle:Object(c.jsx)(V.x,{size:"small"})})]}):e.value?Object(c.jsxs)(c.Fragment,{children:[Object(c.jsx)($,{title:"\u041f\u043e\u043b\u0443\u0447\u0435\u043d\u043d\u044b\u0435 \u0437\u0430\u0439\u043c\u044b",subtitle:"".concat(e.value&&n("borrowed",e.value)," \u20bd")}),Object(c.jsx)($,{title:"\u0412\u044b\u0434\u0430\u043d\u043d\u044b\u0435 \u0437\u0430\u0439\u043c\u044b",subtitle:"".concat(e.value&&n("lent",e.value)," \u20bd")})]}):Object(c.jsxs)(c.Fragment,{children:[Object(c.jsx)($,{title:"\u041f\u043e\u043b\u0443\u0447\u0435\u043d\u043d\u044b\u0435 \u0437\u0430\u0439\u043c\u044b",subtitle:"0 \u20bd"}),Object(c.jsx)($,{title:"\u0412\u044b\u0434\u0430\u043d\u043d\u044b\u0435 \u0437\u0430\u0439\u043c\u044b",subtitle:"0 \u20bd"})]})}})})})}Object(d.b)((function(e){return{friends:g(e)}}))((function(e){return Object(c.jsx)(V.l,{header:Object(c.jsx)(V.m,{mode:"primary",children:"\u041a\u043e\u043d\u0442\u0430\u043a\u0442\u044b"}),mode:"plain",children:e.friends.length>0?(t=e.friends,t.map((function(e){return Object(c.jsxs)(V.w,{before:Object(c.jsx)(V.b,{src:e.photo_100,size:48}),children:[e.first_name," ",e.last_name]})}))):Object(c.jsx)(V.x,{size:"medium"})});var t}));var te=n(305);n(298);var ne=Object(Q.block)("contact-fix");function ce(e){return Object(c.jsx)("div",{className:ne(),children:e.children})}n(299);var re=Object(Q.block)("add-button");function ae(e){return Object(c.jsx)("button",{type:"button",className:re(),onClick:function(){return e.onModalShow&&e.onModalShow("add-debt")},children:Object(c.jsx)(te.a,{color:"#fff"})})}n(300);var se=Object(Q.block)("debt-card");function ie(e){var t,n,r=(t=e.first_name,n=e.last_name,"".concat(t," ").concat(n));return Object(c.jsxs)("div",{className:se(),children:[Object(c.jsx)(V.b,{src:e.photo_100,size:48}),Object(c.jsxs)("div",{className:se("content"),children:[Object(c.jsx)("span",{className:se("username"),children:r}),Object(c.jsxs)("div",{className:se("datestamp"),children:[Object(c.jsx)("span",{className:se("date"),children:e.createdAt}),e.returnDate&&Object(c.jsx)("span",{className:se("date",{return:!0}),children:e.returnDate})]})]}),Object(c.jsxs)("span",{className:se("price"),children:[e.summary," \u20bd"]})]})}n(301);var oe=n(59),ue=n.n(oe),je=Object(Q.block)("debt-container");var le=Object(d.b)((function(e){return{friends:g(e)}}))((function(e){var t=a.a.useState("max-amount"),n=Object(K.a)(t,2),r=n[0],s=n[1],i=window.location.search,o=new URLSearchParams(i).get("vk_user_id");function u(t){return t.map((function(t){var n,r=(n=Number(t.contactId),e.friends.find((function(e){return e.id===n})));return r&&Object(c.jsx)(ie,{first_name:r.first_name,last_name:r.last_name,photo_100:r.photo_100,summary:t.summary,createdAt:t.createdAt,returnDate:t.returnDate})||Object(c.jsx)(a.a.Fragment,{})}))}return console.log("onCHange"),console.log("onCHange123123"),Object(c.jsxs)("div",{className:je(),children:[Object(c.jsxs)("span",{className:je("header"),children:["\u0417\u0430\u0439\u043c\u044b \u043f\u043e ",Object(c.jsxs)("button",{type:"button",onClick:function(){return function(){switch(r){case"max-amount":return s("return-date");case"return-date":return s("max-amount")}}()},children:["max-amount"===r&&"\u0431\u043e\u043b\u044c\u0448\u0435\u0439 \u0441\u0443\u043c\u043c\u0435 \u20bd","return-date"===r&&"\u0434\u0430\u0442\u0435 \u0432\u043e\u0437\u0432\u0440\u0430\u0442\u0430"]})]}),Object(c.jsxs)("div",{className:je("content"),children:["max-amount"===r&&Object(c.jsx)(c.Fragment,{children:Object(c.jsx)(l.b,{path:"".concat(o),children:function(e){return e.isLoading?Object(c.jsx)(V.x,{size:"medium"}):e.value&&u(Object.values(e.value).sort((function(e,t){return Number(t.summary)-Number(e.summary)})))}})}),"return-date"===r&&Object(c.jsx)(c.Fragment,{children:Object(c.jsx)(l.b,{path:"".concat(o),children:function(e){return e.isLoading?Object(c.jsx)(V.x,{size:"medium"}):e.value&&u(Object.values(e.value).sort((function(e,t){return ue()(e.returnDate).diff(ue()(t.returnDate))})))}})})]})]})})),de=(n(302),Object(Q.block)("catalog-item"));function be(e){return Object(c.jsxs)("a",{href:e.href,className:de(),children:[Object(c.jsx)(V.b,{src:e.avatarSrc,size:48}),Object(c.jsx)("span",{className:de("title"),children:e.title}),Object(c.jsx)("span",{className:de("value"),children:e.value})]})}function he(e){return Object(c.jsxs)(V.r,{id:e.id,children:[Object(c.jsx)(V.s,{fixed:!1,children:"\u041a\u0430\u0442\u0430\u043b\u043e\u0433"}),Object(c.jsx)(ce,{children:Object(c.jsx)(be,{href:"https://www.kredito24.ru/",avatarSrc:"https://www.orelbanks.ru/bimage/kredito24-logo.jpg",title:"kredito24",value:"\u0414\u043e 100 \u0440\u0443\u0431"})})]})}function Oe(e){return Object(c.jsxs)(V.r,{id:e.id,children:[Object(c.jsx)(V.s,{fixed:!1,children:"\u0412\u0441\u0435 \u0437\u0430\u0439\u043c\u044b"}),Object(c.jsx)(ae,{onModalShow:e.onShowModal}),Object(c.jsxs)(ce,{children:[Object(c.jsx)(ee,{}),Object(c.jsx)(le,{})]})]})}var me=n(306);var fe,xe=Object(d.b)((function(e){return{friends:g(e)}}))((function(e){var t=a.a.useState(null),n=Object(K.a)(t,2),r=n[0],s=n[1],i=window.location.search,u=new URLSearchParams(i).get("vk_user_id"),j={type:"lent",contactId:null,summary:null,returnDate:null};function d(){return s(null)}function b(e){var t=[];return e.forEach((function(e){t.push({value:e.id,label:"".concat(e.first_name," ").concat(e.last_name),avatar:e.photo_100})})),t}function h(e){return e<10?"0"+e:e}function O(e){var t={};return e.summary?e.contactId||(t.contactId="\u0412\u044b\u0431\u0435\u0440\u0438\u0442\u0435 \u043a\u043e\u043d\u0442\u0430\u043a\u0442"):t.summary="\u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u0447\u0438\u0441\u043b\u043e",t}function m(){return(m=Object(q.a)(N.a.mark((function e(t,n){return N.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log(t),e.next=3,n({type:t.type,contactId:t.contactId,summary:t.summary,returnDate:null===t.returnDate?null:"".concat(h(t.returnDate.day),"-").concat(h(t.returnDate.month),"-").concat(t.returnDate.year),createdAt:ue()().format("DD-MM-YYYY")}).then((function(){d()}));case 3:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var f=Object(c.jsx)(V.q,{activeModal:r,onClose:d,children:Object(c.jsx)(V.o,{settlingHeight:100,id:"add-debt",header:Object(c.jsx)(V.p,{left:Object(c.jsx)(V.t,{onClick:function(){return s(null)},children:Object(c.jsx)(me.a,{})}),children:"\u0414\u043e\u0431\u0430\u0432\u0438\u0442\u044c \u0434\u043e\u043b\u0433"}),children:Object(c.jsx)(l.a,{path:"".concat(u),type:"push",children:function(t){var n=t.runMutation;return Object(c.jsx)(X.c,{initialValues:j,onSubmit:function(e){return function(e,t){return m.apply(this,arguments)}(e,n)},validate:O,children:function(t){var n=t.setFieldValue;return Object(c.jsx)(X.b,{children:Object(c.jsxs)(V.l,{children:[Object(c.jsxs)(V.k,{children:[Object(c.jsx)(V.j,{children:Object(c.jsx)(X.a,{name:"type",children:function(e){var t=e.field;return Object(c.jsx)(V.u,Object(o.a)(Object(o.a)({},t),{},{name:"type",value:"lent",defaultChecked:!0,children:"\u0414\u0430\u043b \u0432 \u0434\u043e\u043b\u0433"}))}})}),Object(c.jsx)(V.j,{children:Object(c.jsx)(X.a,{name:"type",children:function(e){var t=e.field;return Object(c.jsx)(V.u,Object(o.a)(Object(o.a)({},t),{},{name:"type",value:"borrowed",children:"\u0412\u0437\u044f\u043b \u0432 \u0434\u043e\u043b\u0433"}))}})}),Object(c.jsx)(V.j,{top:"\u0421\u0443\u043c\u043c\u0430",children:Object(c.jsx)(X.a,{name:"summary",children:function(e){var t=e.field,n=e.meta;return Object(c.jsxs)("div",{children:[Object(c.jsx)(V.n,Object(o.a)(Object(o.a)({},t),{},{placeholder:"\u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u0441\u0443\u043c\u043c\u0443"})),n.error&&Object(c.jsx)(V.A,{weight:"medium",color:"red",children:n.error})]})}})})]}),Object(c.jsx)(V.j,{top:"\u041a\u043e\u043d\u0442\u0430\u043a\u0442",children:Object(c.jsx)(X.a,{name:"contactId",children:function(t){var n=t.field,r=t.meta;return Object(c.jsxs)("div",{children:[Object(c.jsx)(V.v,Object(o.a)(Object(o.a)({},n),{},{placeholder:"\u0412\u044b\u0431\u0435\u0440\u0438\u0442\u0435 \u043a\u043e\u043d\u0442\u0430\u043a\u0442",options:b(e.friends),renderOption:function(e){var t=e.option,n=Object(J.a)(e,["option"]);return Object(c.jsx)(V.g,Object(o.a)(Object(o.a)({},n),{},{before:Object(c.jsx)(V.b,{size:24,src:t.avatar})}))}})),r.error&&Object(c.jsx)(V.A,{weight:"medium",color:"red",children:r.error})]})}})}),Object(c.jsx)(V.j,{top:"\u0414\u0430\u0442\u0430 \u0432\u043e\u0437\u0440\u0430\u0442\u0430",children:Object(c.jsx)(X.a,{name:"returnDate",children:function(e){var t=e.field;return Object(c.jsx)(V.h,Object(o.a)(Object(o.a)({},t),{},{onDateChange:function(e){isNaN(e.day)||isNaN(e.month)||isNaN(e.year)||n("returnDate",e)},min:{day:1,month:1,year:2021},max:{day:1,month:1,year:9999},dayPlaceholder:"\u0414\u0414",monthPlaceholder:"\u041c\u041c",yearPlaceholder:"\u0413\u0413"}))}})}),Object(c.jsx)(V.j,{children:Object(c.jsx)(V.c,{type:"submit",mode:"primary",stretched:!0,size:"l",children:"\u0414\u043e\u0431\u0430\u0432\u0438\u0442\u044c"})})]})})}})}})})});return Object(c.jsx)(V.B,{id:e.id,modal:f,activePanel:e.activePanel,children:Object(c.jsx)(Oe,{id:e.id,onShowModal:function(e){return s(e)}})})}));function pe(e){return Object(c.jsx)(V.B,{id:e.id,activePanel:e.activePanel,children:Object(c.jsx)(he,{id:e.id})})}!function(e){e.Catalog="catalog",e.App="app"}(fe||(fe={}));var ve=fe;var ye=Object(d.b)(null,(function(e){return{fetchAccessToken:Object(b.bindActionCreators)(G,e)}}))((function(e){var t=a.a.useState(ve.App),n=Object(K.a)(t,2),r=n[0],s=n[1];function i(e){return s(e.currentTarget.dataset.story)}return a.a.useEffect((function(){e.fetchAccessToken()}),[e]),Object(c.jsx)(V.a,{children:Object(c.jsxs)(V.i,{activeStory:r,tabbar:Object(c.jsxs)(V.y,{children:[Object(c.jsx)(V.z,{onClick:i,selected:r===ve.Catalog,"data-story":ve.Catalog,children:Object(c.jsx)(W.a,{})}),Object(c.jsx)(V.z,{onClick:i,selected:r===ve.App,"data-story":ve.App,children:Object(c.jsx)(Y.a,{})})]}),children:[Object(c.jsx)(pe,{id:ve.Catalog,activePanel:ve.Catalog}),Object(c.jsx)(xe,{id:ve.App,activePanel:ve.App})]})})}));function we(){return Object(c.jsx)(l.c,Object(o.a)(Object(o.a)({firebase:u.a},j),{},{children:Object(c.jsx)(d.a,{store:H,children:Object(c.jsx)(ye,{})})}))}n(303);i.a.render(Object(c.jsx)(we,{}),document.getElementById("root"))}},[[304,1,2]]]);
//# sourceMappingURL=main.b5bb404e.chunk.js.map