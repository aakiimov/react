(this["webpackJsonpfinbox-mini-app"]=this["webpackJsonpfinbox-mini-app"]||[]).push([[0],{289:function(e,t,n){},290:function(e,t,n){},291:function(e,t,n){},292:function(e,t,n){},293:function(e,t,n){},294:function(e,t,n){},295:function(e,t,n){"use strict";n.r(t);var a=n(6),c=n(1),r=n.n(c),s=n(45),i=n.n(s),o=n(29),u=n(107),d={apiKey:"AIzaSyCumX0HBTrTWuiyCOkwfSmI_ro5pGEGCzM",authDomain:"finbox-mini-app.firebaseapp.com",databaseURL:"https://finbox-mini-app-default-rtdb.firebaseio.com",projectId:"finbox-mini-app",storageBucket:"finbox-mini-app.appspot.com",messagingSenderId:"261332152446",appId:"1:261332152446:web:1b0638cbb10e860a86a82f"},l=n(37),j=n(35),b=n(31),O=n(108),h=n(101),m=n.n(h),p=n(102),f="SET_USER",x="FETCH_ACCESS_TOKEN",v={access_token:""};var y="SET_FRIENDS",w=[];var g=function(e){return e.friends},k=Object(b.combineReducers)({user:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:v,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case f:return t.payload.user;default:return e}},friends:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:w,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case y:return t.payload.friends;default:return e}}}),_=n(27),C=n.n(_),S=n(36),N=n(46),I=n.n(N),A=C.a.mark(P);function P(){var e,t,n,a;return C.a.wrap((function(c){for(;;)switch(c.prev=c.next){case 0:return e=window.location.search,t=new URLSearchParams(e),n=t.get("vk_app_id"),c.next=5,I.a.send("VKWebAppGetAuthToken",{app_id:Number(n),scope:"friends"}).catch((function(){alert("\u041f\u0440\u0440\u043e\u0438\u0437\u043e\u0448\u043b\u043e \u043a\u0440\u0438\u0442\u0438\u0447\u0435\u0441\u043a\u0430\u044f \u043e\u0448\u0438\u0431\u043a\u0430. \u041f\u043e\u0436\u0430\u043b\u0443\u0439\u0441\u0442\u0430, \u043f\u0435\u0440\u0435\u0437\u0430\u0433\u0440\u0443\u0437\u0438\u0442\u0435 \u043f\u0440\u0438\u043b\u043e\u0436\u0435\u043d\u0438\u0435.")}));case 5:return a=c.sent,c.next=8,Object(S.b)({type:f,payload:{user:{access_token:a.access_token}}});case 8:case"end":return c.stop()}}),A)}var z=C.a.mark(E);function E(){return C.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(S.c)(x,P);case 2:case"end":return e.stop()}}),z)}var T=C.a.mark(M);function M(){var e;return C.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,I.a.send("VKWebAppCallAPIMethod",{method:"friends.get",params:{order:"hints",fields:"nickname,photo_100",v:"5.21",access_token:V.getState().user.access_token}}).catch((function(){alert("\u041f\u0440\u0440\u043e\u0438\u0437\u043e\u0448\u043b\u043e \u043a\u0440\u0438\u0442\u0438\u0447\u0435\u0441\u043a\u0430\u044f \u043e\u0448\u0438\u0431\u043a\u0430. \u041f\u043e\u0436\u0430\u043b\u0443\u0439\u0441\u0442\u0430, \u043f\u0435\u0440\u0435\u0437\u0430\u0433\u0440\u0443\u0437\u0438\u0442\u0435 \u043f\u0440\u0438\u043b\u043e\u0436\u0435\u043d\u0438\u0435.")}));case 2:return e=t.sent,t.next=5,Object(S.b)({type:y,payload:{friends:e.response.items}});case 5:case"end":return t.stop()}}),T)}var L=C.a.mark(R);function R(){return C.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(S.c)(f,M);case 2:case"end":return e.stop()}}),L)}var U=C.a.mark(B);function B(){return C.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(S.a)([E(),R()]);case 2:case"end":return e.stop()}}),U)}var D=n(103),K=Object(O.a)(),V=Object(b.createStore)(k,Object(p.composeWithDevTools)(Object(b.applyMiddleware)(m.a,K)));Object(D.a)();K.run(B);var W=n(44),F=n(10),G=n(298),q=n(299);function H(){return{type:x}}var J=n(109),X=n(106);function Q(e){return Object(a.jsx)(F.q,{id:e.id,children:Object(a.jsx)(F.r,{children:"\u041a\u0430\u0442\u0430\u043b\u043e\u0433"})})}var Y=n(34),Z=(n(289),Object(Y.block)("dashboard-card"));function $(e){return Object(a.jsx)(F.c,{children:Object(a.jsxs)("div",{className:Z(),children:[e.title&&Object(a.jsx)("span",{className:Z("subtitle"),children:e.title}),e.subtitle&&Object(a.jsx)("strong",{className:Z("title"),children:e.subtitle})]})})}function ee(){var e=window.location.search,t=new URLSearchParams(e).get("vk_user_id");function n(e){var t=0;return Object.values(e).forEach((function(e){t=Number(e.summary)+t})),t}return Object(a.jsx)(F.k,{mode:"plain",children:Object(a.jsxs)(F.d,{size:"m",children:[Object(a.jsx)(l.b,{path:"".concat(t,"/borrowed"),children:function(e){return e.isLoading?Object(a.jsx)(F.w,{size:"medium"}):e.value?Object(a.jsx)($,{title:"\u041f\u043e\u043b\u0443\u0447\u0435\u043d\u043d\u044b\u0435 \u0437\u0430\u0439\u043c\u044b",subtitle:"".concat(e.value&&n(e.value)," \u20bd")}):Object(a.jsx)($,{title:"\u041f\u043e\u043b\u0443\u0447\u0435\u043d\u043d\u044b\u0435 \u0437\u0430\u0439\u043c\u044b",subtitle:"0 \u20bd"})}}),Object(a.jsx)(l.b,{path:"".concat(t,"/lent"),children:function(e){return e.isLoading?Object(a.jsx)(F.w,{size:"medium"}):e.value?Object(a.jsx)($,{title:"\u0412\u044b\u0434\u0430\u043d\u043d\u044b\u0435 \u0437\u0430\u0439\u043c\u044b",subtitle:"".concat(e.value&&n(e.value)," \u20bd")}):Object(a.jsx)($,{title:"\u0412\u044b\u0434\u0430\u043d\u043d\u044b\u0435 \u0437\u0430\u0439\u043c\u044b",subtitle:"0 \u20bd"})}})]})})}Object(j.b)((function(e){return{friends:g(e)}}))((function(e){return Object(a.jsx)(F.k,{header:Object(a.jsx)(F.l,{mode:"primary",children:"\u041a\u043e\u043d\u0442\u0430\u043a\u0442\u044b"}),mode:"plain",children:e.friends.length>0?(t=e.friends,t.map((function(e){return Object(a.jsxs)(F.v,{before:Object(a.jsx)(F.b,{src:e.photo_100,size:48}),children:[e.first_name," ",e.last_name]})}))):Object(a.jsx)(F.w,{size:"medium"})});var t}));var te=n(296);n(290);var ne=Object(Y.block)("contact-fix");function ae(e){return Object(a.jsx)("div",{className:ne(),children:e.children})}n(291);var ce=Object(Y.block)("add-button");function re(e){return Object(a.jsx)("button",{type:"button",className:ce(),onClick:function(){return e.onModalShow&&e.onModalShow("add-debt")},children:Object(a.jsx)(te.a,{color:"#fff"})})}n(292);var se=Object(Y.block)("debt-card");function ie(e){var t,n,c=(t=e.first_name,n=e.last_name,"".concat(t," ").concat(n));return Object(a.jsxs)("div",{className:se(),children:[Object(a.jsx)(F.b,{src:e.photo_100,size:48}),Object(a.jsxs)("div",{className:se("content"),children:[Object(a.jsx)("span",{className:se("username"),children:c}),Object(a.jsxs)("div",{className:se("datestamp"),children:[Object(a.jsx)("span",{className:se("date"),children:"12.12.2020"}),Object(a.jsx)("span",{className:se("date"),children:"20.12.2020"})]})]}),Object(a.jsxs)("span",{className:se("price"),children:[e.summary," \u20bd"]})]})}n(293);var oe=Object(Y.block)("debt-container");var ue=Object(j.b)((function(e){return{friends:g(e)}}))((function(e){var t=r.a.useState("max-amount"),n=Object(W.a)(t,2),c=n[0],s=n[1],i=window.location.search,o=new URLSearchParams(i).get("vk_user_id");function u(t){return Object.values(t).sort((function(e,t){return"max-amount"===c?Number(t.summary)-Number(e.summary):"return-date"===c?Number(e.summary)-Number(t.summary):e})).map((function(t){var n,c=(n=Number(t.contactId),e.friends.find((function(e){return e.id===n})));return c&&Object(a.jsx)(ie,{first_name:c.first_name,last_name:c.last_name,photo_100:c.photo_100,summary:t.summary})||Object(a.jsx)(r.a.Fragment,{})}))}return Object(a.jsxs)("div",{className:oe(),children:[Object(a.jsxs)("span",{className:oe("header"),children:["\u0417\u0430\u0439\u043c\u044b \u043f\u043e ",Object(a.jsxs)("button",{type:"button",onClick:function(){return function(){switch(c){case"max-amount":return s("return-date");case"return-date":return s("max-amount")}}()},children:["max-amount"===c&&"\u0431\u043e\u043b\u044c\u0448\u0435\u0439 \u0441\u0443\u043c\u043c\u0435 \u20bd","return-date"===c&&"\u0434\u0430\u0442\u0435 \u0432\u043e\u0437\u0432\u0440\u0430\u0442\u0430"]})]}),Object(a.jsxs)("div",{className:oe("content"),children:[Object(a.jsx)(l.b,{path:"".concat(o,"/borrowed"),children:function(e){return e.isLoading?Object(a.jsx)(F.w,{size:"medium"}):e.value&&u(e.value)}}),Object(a.jsx)(l.b,{path:"".concat(o,"/lent"),children:function(e){return e.isLoading?Object(a.jsx)(F.w,{size:"medium"}):e.value&&u(e.value)}})]})]})}));function de(e){return Object(a.jsxs)(F.q,{id:e.id,children:[Object(a.jsx)(F.r,{children:"\u0412\u0441\u0435 \u0437\u0430\u0439\u043c\u044b"}),Object(a.jsx)(re,{onModalShow:e.onShowModal}),Object(a.jsxs)(ae,{children:[Object(a.jsx)(ee,{}),Object(a.jsx)(ue,{})]})]})}var le=n(297);var je,be=Object(j.b)((function(e){return{friends:g(e)}}))((function(e){var t=r.a.useState(null),n=Object(W.a)(t,2),c=n[0],s=n[1],i=r.a.useState({type:"lent",summary:null,contactId:null,date:null}),u=Object(W.a)(i,2),d=u[0],j=u[1],b=window.location.search,O=new URLSearchParams(b).get("vk_user_id");function h(){return s(null)}console.log(d);var m=Object(a.jsx)(F.p,{activeModal:c,onClose:h,children:Object(a.jsx)(F.n,{id:"add-debt",header:Object(a.jsx)(F.o,{left:Object(a.jsx)(F.s,{onClick:function(){return s(null)},children:Object(a.jsx)(le.a,{})}),right:null!==d.type&&null!==d.summary&&null!==d.contactId&&null!==d.date&&Object(a.jsx)(l.a,{path:"".concat(O,"/").concat(d.type),type:"push",children:function(e){var t=e.runMutation;return Object(a.jsx)(F.s,{onClick:Object(X.a)(C.a.mark((function e(){return C.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t({summary:d.summary,contactId:d.contactId,date:d.date});case 2:h();case 3:case"end":return e.stop()}}),e)}))),children:Object(a.jsx)(te.a,{})})}}),children:"\u0414\u043e\u0431\u0430\u0432\u0438\u0442\u044c \u0434\u043e\u043b\u0433"}),children:Object(a.jsxs)(F.k,{children:[Object(a.jsxs)(F.j,{children:[Object(a.jsx)(F.i,{children:Object(a.jsx)(F.t,{name:"type",value:"lent",defaultChecked:"lent"===d.type||void 0,onChange:function(e){j(Object(o.a)(Object(o.a)({},d),{},{type:e.target.value}))},children:"\u0414\u0430\u043b \u0432 \u0434\u043e\u043b\u0433"})}),Object(a.jsx)(F.i,{children:Object(a.jsx)(F.t,{name:"type",value:"borrowed",defaultChecked:"borrowed"===d.type||void 0,onChange:function(e){j(Object(o.a)(Object(o.a)({},d),{},{type:e.target.value}))},children:"\u0412\u0437\u044f\u043b \u0432 \u0434\u043e\u043b\u0433"})}),Object(a.jsx)(F.i,{top:"\u0421\u0443\u043c\u043c\u0430",children:Object(a.jsx)(F.m,{defaultValue:null!==d.summary?d.summary:void 0,placeholder:"\u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u0441\u0443\u043c\u043c\u0443",onBlur:function(e){j(Object(o.a)(Object(o.a)({},d),{},{summary:e.target.value}))}})})]}),Object(a.jsx)(F.i,{top:"\u041a\u043e\u043d\u0442\u0430\u043a\u0442",children:Object(a.jsx)(F.u,{placeholder:"\u0412\u044b\u0431\u0435\u0440\u0438\u0442\u0435 \u043a\u043e\u043d\u0442\u0430\u043a\u0442",options:function(e){var t=[];return e.forEach((function(e){t.push({value:e.id,label:"".concat(e.first_name," ").concat(e.last_name),avatar:e.photo_100})})),t}(e.friends),defaultValue:null!==d.contactId?d.contactId:void 0,onChange:function(e){j(Object(o.a)(Object(o.a)({},d),{},{contactId:e.target.value}))},renderOption:function(e){var t=e.option,n=Object(J.a)(e,["option"]);return Object(a.jsx)(F.f,Object(o.a)(Object(o.a)({},n),{},{before:Object(a.jsx)(F.b,{size:24,src:t.avatar})}))}})}),Object(a.jsx)(F.i,{top:"\u0414\u0430\u0442\u0430",children:Object(a.jsx)(F.g,{min:{day:1,month:1,year:1901},max:{day:1,month:1,year:2006},onDateChange:function(e){j(Object(o.a)(Object(o.a)({},d),{},{date:e}))},dayPlaceholder:"\u0414\u0414",monthPlaceholder:"\u041c\u041c",yearPlaceholder:"\u0413\u0413"})})]})})});return Object(a.jsx)(F.z,{id:e.id,modal:m,activePanel:e.activePanel,children:Object(a.jsx)(de,{id:e.id,onShowModal:function(e){return s(e)}})})}));function Oe(e){return Object(a.jsx)(F.z,{id:e.id,activePanel:e.activePanel,children:Object(a.jsx)(Q,{id:e.id})})}!function(e){e.Catalog="catalog",e.App="app"}(je||(je={}));var he=je;var me=Object(j.b)(null,(function(e){return{fetchAccessToken:Object(b.bindActionCreators)(H,e)}}))((function(e){var t=r.a.useState(he.App),n=Object(W.a)(t,2),c=n[0],s=n[1];function i(e){return s(e.currentTarget.dataset.story)}return r.a.useEffect((function(){e.fetchAccessToken()}),[e]),Object(a.jsx)(F.a,{children:Object(a.jsxs)(F.h,{activeStory:c,tabbar:Object(a.jsxs)(F.x,{children:[Object(a.jsx)(F.y,{onClick:i,selected:c===he.Catalog,"data-story":he.Catalog,children:Object(a.jsx)(G.a,{})}),Object(a.jsx)(F.y,{onClick:i,selected:c===he.App,"data-story":he.App,children:Object(a.jsx)(q.a,{})})]}),children:[Object(a.jsx)(Oe,{id:he.Catalog,activePanel:he.Catalog}),Object(a.jsx)(be,{id:he.App,activePanel:he.App})]})})}));function pe(){return Object(a.jsx)(l.c,Object(o.a)(Object(o.a)({firebase:u.a},d),{},{children:Object(a.jsx)(j.a,{store:V,children:Object(a.jsx)(me,{})})}))}n(294);i.a.render(Object(a.jsx)(pe,{}),document.getElementById("root"))}},[[295,1,2]]]);
//# sourceMappingURL=main.b9f2ab7a.chunk.js.map